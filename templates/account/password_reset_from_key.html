{% extends "main/main.html" %}
{% load i18n %}

{% block content %}
<div class="container">
  <div class="row justify-content-center text-center">
    <div class="col-md-6">

      <h2>{% trans "Set a new password" %}</h2>

      {% if token_fail %}
        <div class="alert alert-danger text-start" role="alert">
          {% trans "The password reset link was invalid, possibly because it has already been used. Please request a new password reset." %}
        </div>

        <p class="mt-3">
          <a class="btn btn-secondary" href="{% url 'account_reset_password' %}">
            {% trans "Request a new link" %}
          </a>
        </p>

      {% else %}
        <form method="post" action="">
          {% csrf_token %}

          {# Optional: show non-field errors nicely #}
          {% if form.non_field_errors %}
            <div class="alert alert-danger text-start" role="alert">
              {{ form.non_field_errors }}
            </div>
          {% endif %}

          <div class="mb-3 text-start">
            <label for="id_password1" class="form-label">{% trans "New password" %}</label>

            <div class="password-wrapper">
              {{ form.password1 }}
              <button type="button" class="toggle-password" data-target="id_password1">
                <i class="fa-solid fa-eye"></i>
              </button>
            </div>

            <div id="caps-warning-id_password1" class="caps-warning" style="display:none;">
              <i class="fa-solid fa-triangle-exclamation"></i> {% trans "Caps Lock is on" %}
            </div>

            {% if form.password1.errors %}
              <div class="invalid-feedback d-block">
                {{ form.password1.errors }}
              </div>
            {% endif %}
          </div>

          <div class="mb-3 text-start">
            <label for="id_password2" class="form-label">{% trans "Confirm new password" %}</label>

            <div class="password-wrapper">
              {{ form.password2 }}
              <button type="button" class="toggle-password" data-target="id_password2">
                <i class="fa-solid fa-eye"></i>
              </button>
            </div>

            <div id="caps-warning-id_password2" class="caps-warning" style="display:none;">
              <i class="fa-solid fa-triangle-exclamation"></i> {% trans "Caps Lock is on" %}
            </div>

            {% if form.password2.errors %}
              <div class="invalid-feedback d-block">
                {{ form.password2.errors }}
              </div>
            {% endif %}
          </div>

          <p>
            <button type="submit" class="btn btn-secondary">
              {% trans "Change password" %}
            </button>
          </p>
        </form>
      {% endif %}

      <p class="mt-3">
        <a class="link-action" href="{% url 'account_login' %}">{% trans "Back to login" %}</a>
      </p>

    </div>
  </div>
</div>
{% endblock %}